<html>
    <head>  
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
        <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous">
        </script>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

        <script>
            render = {
                exercises: function ( data ) {
                    let context = $( '#exercises' ).get()[0];

                    for (let level of data.levels) {
                        let e = '<li><div class="collapsible-header">' + (level.name) +  '</div><div class="collapsible-body collection">';

                        for (let exercise of data.exercises) {
                            if ( exercise.level_id == level.id ) {
                                e += '<a class="collection-item" onclick="requests.exercise( this.dataset.exercise )" data-exercise="' + (exercise.id) + '">' + (exercise.name) + '</a>';
                            }
                        }

                        e += '</div></li>'

                        $( '.collapsible', context).append( e );
                    }
                },
                question: function ( question ) {
                    console.log(question);
                    let context = $( '#question' ).get()[0];
                    $( '.collection-header h4', context ).html( question.vraag );
                    console.log(question.type);
                    switch (question.type) {
                        case 0:
                            $( '#answer', context ).html( 
                                `<input type="text" value="">
                                <div class="btn right">Submit</div>` 
                            );
                            break;
                        case 1:

                            break;
                    }
                },
            };

            let requests = {
                exercise: function ( id ) {
                    socket.emit( 'exercise', { id }, data => {
                        console.log( data );
                    });
                },
            };

            $( function () {
                $('.collapsible').collapsible();

                socket = io( 'http://localhost:3000' );
            
                socket.on( 'connect' , () => {
                    exercise = null;

                    socket.emit( 'exercises', {}, ( data ) => {
                        render.exercises( data );
                    });
                });

                socket.on( 'disconnect', () => {
                    $( '#exercises .collapsible').children().remove();
                });
            });
        </script>

        <style>
            .container {
                width: 100%;
                max-width:initial;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col s12 m4 l2">
                    <div id="exercises">
                        <ul class="collapsible"></ul>
                    </div>
                </div>
                <div class="col s12 m8 l6">
                    <div id="question" class="collection with-header">
                        <div class="collection-header"><h4>What is the meaning of life? __</h4></div>
                        <div id="answer">
                            <!-- <input type="text" value=""> -->
                            <!-- <div class="btn right">Submit</div> -->
                            <!-- <a class="collection-item">a) 42</a> -->
                            <!-- <a class="collection-item">b) 42</a> -->
                            <!-- <a class="collection-item">c) 42</a> -->
                            <!-- <a class="collection-item">d) 42</a> -->
                        </div>
                    </div>
                </div>
                <div class="col s12 m12 l4">
                    <div id="progress" class="collection with-header">
                        <div class="collection-header">
                            <h5>Progress</h5>
                            <div class="progress">
                                <div class="determinate" style="width: 70%"></div>
                            </div>
                        </div>
                        <div id="completed" class="collection-item">1 out of 3 completed</div>
                        <div id="correct" class="collection-item green-text">2 out of 3 correct</div>
                        <div id="incorrect" class="collection-item red-text">1 out of 3 incorrect</div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>